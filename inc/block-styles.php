<?php

if ( ! function_exists( 'darkpastel_output_svg_clip_paths' ) ) {
	/**
	 * Adds SVG clipPath elements to `wp_footer` so that they are availble to be used
	 * by separator block styles, for fancy ornamental separators.
	 * 
	 * @since Dark Pastel 1.0
	 * 
	 * @return void
	 */
	function darkpastel_output_svg_clip_paths() {
		/*
		* When calling via the in_admin_header action, we only want to render the
		* SVGs on block editor pages.
		* Logic borrowed from: wp_global_styles_render_svg_filters.
		*/
		if (
			is_admin() &&
			! get_current_screen()->is_block_editor()
		) {
			return;
		}

		//         <svg width="883.836" height="91.448" viewBox="0 0 220.959 22.862" xmlns="http://www.w3.org/2000/svg">

		// <svg
		// 	xmlns="http://www.w3.org/2000/svg"
		// 	viewBox="0 0 0 0"
		// 	width="0"
		// 	height="0"
		// 	focusable="false"
		// 	role="none"
		// 	style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"
		// >

		//  viewBox="0 0 220.959 22.862"

		// Thanks to: https://www.smashingmagazine.com/2015/05/creating-responsive-shapes-with-clip-path/
		// Thanks to: https://yoksel.github.io/relative-clip-path/

		// <path style="fill:#000;fill-rule:nonzero;stroke:none;stroke-width:.25" d="M114.798 249.301c3.24-1.008 6.03-3.409 7.207-6.555.993-2.651.79-5.718-.805-7.942a9.202 9.202 0 0 0-5.608-3.573c-2.346-.463-4.717.159-6.379 1.51a6.725 6.725 0 0 0-2.373 4.183c-.263 1.771.355 3.442 1.4 4.488a4.288 4.288 0 0 0 2.777 1.223c1.212.065 2.17-.571 2.595-1.303.311-.546.215-1.184.085-1.579-.09-.279-.232-.48-.418-.586-.454-.25-.759.052-.759.052s.322-.287.743-.025c.175.107.299.303.378.576.11.391.18 1.014-.13 1.502-.424.685-1.354 1.24-2.479 1.144-.878-.076-1.85-.465-2.565-1.225-.946-.998-1.461-2.575-1.176-4.194a6.238 6.238 0 0 1 2.286-3.8c1.544-1.204 3.745-1.712 5.866-1.25 1.96.428 3.843 1.614 5.064 3.353 1.39 1.944 1.502 4.723.606 7.112-1.06 2.823-3.65 5.002-6.613 5.935-1.366.427-2.944.668-4.742.653a19.135 19.135 0 0 1-.01 0 121.636 121.636 0 0 1-.011 0c-52.842 1.823-69.06-32.112-90.487-17.442a27.218 27.218 0 0 0-.01.007l-.008.007c-2.321 1.75-4.029 4.273-4.704 7.066-.688 2.853-.115 5.895 1.53 8.167a9.206 9.206 0 0 0 5.61 3.576c2.347.462 4.719-.159 6.383-1.511a6.729 6.729 0 0 0 2.375-4.187c.262-1.772-.357-3.444-1.402-4.491a4.29 4.29 0 0 0-2.78-1.223c-1.212-.064-2.17.572-2.595 1.305-.312.546-.215 1.184-.085 1.58.09.278.232.48.418.585.454.251.76-.051.76-.051s-.323.286-.744.024c-.175-.107-.298-.303-.377-.576-.11-.391-.179-1.014.13-1.501.425-.684 1.354-1.238 2.478-1.142.878.076 1.85.464 2.563 1.224.946.999 1.46 2.575 1.174 4.192a6.234 6.234 0 0 1-2.284 3.797c-1.545 1.204-3.745 1.71-5.863 1.247-1.96-.427-3.84-1.613-5.06-3.35-1.463-2.065-1.94-4.86-1.296-7.436.635-2.554 2.233-4.881 4.371-6.497l-.019.014C40.617 218.14 56.59 251.834 109.771 250h-.021c1.893.016 3.574-.237 5.048-.699zM134.944 248.15c-2.963-.933-5.554-3.113-6.614-5.935-.896-2.39-.783-5.169.606-7.113 1.222-1.739 3.105-2.925 5.064-3.352 2.121-.462 4.322.045 5.867 1.25a6.238 6.238 0 0 1 2.285 3.8c.286 1.618-.23 3.195-1.176 4.194-.715.76-1.687 1.148-2.565 1.224-1.125.096-2.055-.459-2.48-1.144-.308-.488-.24-1.11-.129-1.501.08-.273.203-.47.378-.576.422-.262.743.024.743.024s-.305-.302-.758-.051c-.186.105-.33.307-.419.586-.13.394-.226 1.033.086 1.578.425.732 1.383 1.368 2.594 1.303a4.289 4.289 0 0 0 2.778-1.222c1.044-1.046 1.663-2.717 1.4-4.489a6.725 6.725 0 0 0-2.374-4.183c-1.662-1.35-4.033-1.972-6.378-1.51a9.202 9.202 0 0 0-5.608 3.573c-1.596 2.224-1.799 5.291-.805 7.943 1.177 3.146 3.966 5.546 7.206 6.555 1.474.461 3.156.714 5.048.698h-.021c53.181 1.835 69.155-31.858 89.956-17.616l-.019-.014c2.138 1.616 3.736 3.943 4.372 6.497.643 2.576.166 5.371-1.296 7.437-1.22 1.736-3.102 2.922-5.06 3.35-2.12.461-4.319-.044-5.863-1.248a6.234 6.234 0 0 1-2.285-3.797c-.285-1.617.229-3.193 1.174-4.192.714-.76 1.686-1.148 2.563-1.224 1.124-.096 2.054.458 2.479 1.142.308.487.24 1.11.13 1.501-.08.273-.203.47-.378.576a.624.624 0 0 1-.743-.024s.305.302.759.051c.186-.105.329-.307.419-.586.13-.394.226-1.033-.085-1.58-.425-.732-1.384-1.368-2.596-1.304a4.29 4.29 0 0 0-2.78 1.223c-1.045 1.047-1.664 2.719-1.401 4.491a6.729 6.729 0 0 0 2.374 4.187c1.665 1.352 4.037 1.973 6.383 1.51a9.206 9.206 0 0 0 5.61-3.575c1.645-2.272 2.219-5.314 1.53-8.167-.675-2.793-2.382-5.316-4.703-7.066l-.01-.007a27.218 27.218 0 0 0-.01-.007c-21.426-14.67-37.644 19.265-90.486 17.442a121.636 121.636 0 0 1-.01 0 19.135 19.135 0 0 1-.01 0c-1.799.015-3.376-.226-4.742-.653z" transform="translate(-14.242 -227.67)"/>

		// Double separator SVG.
		// $separator_ornament_double_svg = <<<'SVGSNIPPET'
		// <svg width="0" height="0" viewBox="0 0 220.959 22.862" xmlns="http://www.w3.org/2000/svg">
		// <defs>
		// 	<clipPath id="darkpastel-double-ornament-cp" clipPathUnits="objectBoundingBox">
		// 		<path d="M0.52,10 c0.015,-0.044,0.027,-0.149,0.033,-0.287 c0.004,-0.116,0.004,-0.25,-0.004,-0.347 a0.042,0.403,0,0,0,-0.025,-0.156 c-0.011,-0.02,-0.021,0.007,-0.029,0.066 a0.03,0.294,0,0,0,-0.011,0.183 c-0.001,0.077,0.002,0.151,0.006,0.196 a0.019,0.188,0,0,0,0.013,0.053 c0.005,0.003,0.01,-0.025,0.012,-0.057 c0.001,-0.024,0.001,-0.052,0,-0.069 c0,-0.012,-0.001,-0.021,-0.002,-0.026 c-0.002,-0.011,-0.003,0.002,-0.003,0.002 s0.001,-0.013,0.003,-0.001 c0.001,0.005,0.001,0.013,0.002,0.025 c0,0.017,0.001,0.044,-0.001,0.066 c-0.002,0.03,-0.006,0.054,-0.011,0.05 c-0.004,-0.003,-0.008,-0.02,-0.012,-0.054 c-0.004,-0.044,-0.007,-0.113,-0.005,-0.183 a0.028,0.273,0,0,1,0.01,-0.166 c0.007,-0.053,0.017,-0.075,0.027,-0.055 c0.009,0.019,0.017,0.071,0.023,0.147 c0.006,0.085,0.007,0.207,0.003,0.311 c-0.005,0.123,-0.017,0.219,-0.03,0.26 c-0.006,0.019,-0.013,0.029,-0.021,0.029 a0.087,0.837,0,0,1,0,0 a0.55,5,0,0,1,0,0 c-0.239,0.08,-0.313,-1.405,-0.41,-0.763 a0.123,1,0,0,0,0,0 l0,0 c-0.011,0.077,-0.018,0.187,-0.021,0.309 c-0.003,0.125,-0.001,0.258,0.007,0.357 a0.042,0.403,0,0,0,0.025,0.156 c0.011,0.02,0.021,-0.007,0.029,-0.066 a0.03,0.294,0,0,0,0.011,-0.183 c0.001,-0.078,-0.002,-0.151,-0.006,-0.196 a0.019,0.188,0,0,0,-0.013,-0.053 c-0.005,-0.003,-0.01,0.025,-0.012,0.057 c-0.001,0.024,-0.001,0.052,0,0.069 c0,0.012,0.001,0.021,0.002,0.026 c0.002,0.011,0.003,-0.002,0.003,-0.002 s-0.001,0.013,-0.003,0.001 c-0.001,-0.005,-0.001,-0.013,-0.002,-0.025 c0,-0.017,-0.001,-0.044,0.001,-0.066 c0.002,-0.03,0.006,-0.054,0.011,-0.05 c0.004,0.003,0.008,0.02,0.012,0.054 c0.004,0.044,0.007,0.113,0.005,0.183 a0.028,0.273,0,0,1,-0.01,0.166 c-0.007,0.053,-0.017,0.075,-0.027,0.055 c-0.009,-0.019,-0.017,-0.071,-0.023,-0.147 c-0.007,-0.09,-0.009,-0.213,-0.006,-0.325 c0.003,-0.112,0.01,-0.213,0.02,-0.284 l0,0.001 C0.184,9,0.256,11,0.497,10 h0 c0.009,0.001,0.016,-0.01,0.023,-0.031 M0.611,10 c-0.013,-0.041,-0.025,-0.136,-0.03,-0.26 c-0.004,-0.105,-0.004,-0.226,0.003,-0.311 c0.006,-0.076,0.014,-0.128,0.023,-0.147 c0.01,-0.02,0.02,0.002,0.027,0.055 a0.028,0.273,0,0,1,0.01,0.166 c0.001,0.071,-0.001,0.14,-0.005,0.183 c-0.003,0.033,-0.008,0.05,-0.012,0.054 c-0.005,0.004,-0.009,-0.02,-0.011,-0.05 c-0.001,-0.021,-0.001,-0.049,-0.001,-0.066 c0,-0.012,0.001,-0.021,0.002,-0.025 c0.002,-0.011,0.003,0.001,0.003,0.001 s-0.001,-0.013,-0.003,-0.002 c-0.001,0.005,-0.001,0.013,-0.002,0.026 c-0.001,0.017,-0.001,0.045,0,0.069 c0.002,0.032,0.006,0.06,0.012,0.057 a0.019,0.188,0,0,0,0.013,-0.053 c0.005,-0.046,0.008,-0.119,0.006,-0.196 a0.03,0.294,0,0,0,-0.011,-0.183 c-0.008,-0.059,-0.018,-0.086,-0.029,-0.066 a0.042,0.403,0,0,0,-0.025,0.156 c-0.007,0.097,-0.008,0.231,-0.004,0.347 c0.005,0.138,0.018,0.243,0.033,0.287 c0.007,0.02,0.014,0.031,0.023,0.031 h0 c0.241,0.08,0.313,-1.393,0.407,-0.771 l0,-0.001 c0.01,0.071,0.017,0.172,0.02,0.284 c0.003,0.113,0.001,0.235,-0.006,0.325 c-0.006,0.076,-0.014,0.128,-0.023,0.147 c-0.01,0.02,-0.02,-0.002,-0.027,-0.055 a0.028,0.273,0,0,1,-0.01,-0.166 c-0.001,-0.071,0.001,-0.14,0.005,-0.183 c0.003,-0.033,0.008,-0.05,0.012,-0.054 c0.005,-0.004,0.009,0.02,0.011,0.05 c0.001,0.021,0.001,0.049,0.001,0.066 c0,0.012,-0.001,0.021,-0.002,0.025 a0.003,0.027,0,0,1,-0.003,-0.001 s0.001,0.013,0.003,0.002 c0.001,-0.005,0.001,-0.013,0.002,-0.026 c0.001,-0.017,0.001,-0.045,0,-0.069 c-0.002,-0.032,-0.006,-0.06,-0.012,-0.057 a0.019,0.188,0,0,0,-0.013,0.053 c-0.005,0.046,-0.008,0.119,-0.006,0.196 a0.03,0.294,0,0,0,0.011,0.183 c0.008,0.059,0.018,0.086,0.029,0.066 a0.042,0.403,0,0,0,0.025,-0.156 c0.007,-0.099,0.01,-0.232,0.007,-0.357 c-0.003,-0.122,-0.011,-0.233,-0.021,-0.309 l0,0 a0.123,1,0,0,0,0,0 c-0.097,-0.642,-0.17,0.843,-0.41,0.763 a0.55,5,0,0,1,0,0 a0.087,0.837,0,0,1,0,0 c-0.008,0.001,-0.015,-0.01,-0.021,-0.029"/>
		// 	</clipPath>
		// </defs>
		// </svg>
		// SVGSNIPPET;

		// $separator_ornament_narrow_svg = <<<'SVGSNIPPET'
		// <svg class="svg">
		// 	<clipPath id="darkpastel-narrow-ornament-cp" clipPathUnits="objectBoundingBox"><path d="M0.92,1 C0.962,0.938,0.991,0.817,1,0.686 C1,0.549,1,0.405,0.975,0.297 A0.157,0.433,0,0,0,0.879,0.129 C0.839,0.107,0.799,0.136,0.77,0.2 A0.115,0.316,0,0,0,0.73,0.397 C0.725,0.48,0.736,0.559,0.754,0.608 A0.073,0.202,0,0,0,0.801,0.666 C0.822,0.669,0.838,0.639,0.845,0.604 C0.851,0.579,0.849,0.549,0.847,0.53 C0.845,0.517,0.843,0.507,0.84,0.502 C0.832,0.491,0.827,0.505,0.827,0.505 S0.832,0.491,0.839,0.504 C0.842,0.509,0.845,0.518,0.846,0.531 C0.848,0.549,0.849,0.578,0.844,0.601 C0.836,0.634,0.821,0.66,0.801,0.655 C0.786,0.652,0.77,0.633,0.758,0.598 C0.742,0.551,0.733,0.476,0.738,0.4 A0.106,0.293,0,0,1,0.777,0.222 C0.803,0.165,0.841,0.141,0.877,0.163 C0.91,0.183,0.942,0.239,0.963,0.321 C0.988,0.419,0.997,0.552,0.986,0.675 C0.976,0.795,0.949,0.906,0.911,0.975 C0.815,1,0.682,1,0.513,0.588 C0.341,0.116,0.199,0,0.093,0.195 C0.052,0.272,0.022,0.392,0.011,0.524 C0,0.66,0.01,0.805,0.039,0.913 A0.157,0.433,0,0,0,0.134,1 C0.174,1,0.215,1,0.243,1 A0.115,0.316,0,0,0,0.284,0.813 C0.288,0.729,0.278,0.651,0.26,0.602 A0.073,0.202,0,0,0,0.212,0.544 C0.192,0.541,0.175,0.571,0.168,0.605 C0.163,0.631,0.165,0.661,0.167,0.68 C0.168,0.693,0.171,0.702,0.174,0.707 C0.182,0.719,0.187,0.705,0.187,0.705 S0.181,0.718,0.174,0.706 C0.171,0.701,0.169,0.692,0.168,0.679 C0.166,0.66,0.165,0.631,0.17,0.608 C0.177,0.576,0.193,0.55,0.212,0.554 C0.227,0.558,0.244,0.576,0.256,0.612 C0.272,0.659,0.281,0.733,0.276,0.809 A0.106,0.293,0,0,1,0.237,0.988 C0.211,1,0.173,1,0.137,1 C0.104,1,0.071,0.971,0.051,0.889 C0.025,0.79,0.017,0.658,0.027,0.534 C0.038,0.414,0.065,0.304,0.103,0.234 C0.199,0.057,0.332,0.157,0.501,0.621 C0.672,1,0.815,1,0.92,1"></path></clipPath>
		// </svg>
		// SVGSNIPPET;

		// $star_svg = <<<'SVGSNIPPET'
		// <svg class="svg">
		// 	<clipPath id="darkpastel-star-cp" clipPathUnits="objectBoundingBox"><path d="M0.5,0.846 L0.191,1,0.235,0.643 L0,0.382 L0.336,0.315 L0.5,0 L0.664,0.315,1,0.382,0.765,0.643,0.809,1"></path></clipPath>
		// </svg>
		// SVGSNIPPET;

		// echo $separator_ornament_double_svg;
		// echo $separator_ornament_narrow_svg;
		// echo $star_svg;
	}
}

// add_action( 'wp_footer', 'darkpastel_output_svg_clip_paths', 1 );

// SVG filters like duotone have to be loaded at the beginning of the body in both admin and the front-end.
add_action( 'wp_body_open', 'darkpastel_output_svg_clip_paths' );
add_action( 'in_admin_header', 'darkpastel_output_svg_clip_paths' );

if ( ! function_exists( 'darkpastel_register_block_styles' ) ) {
	/**
	 * Register theme specific block styles.
	 * 
	 * @since Dark Pastel 1.0
	 * 
	 * @return void
	 */
	// TODO: Try to output the SVG to the site frontend, as it happens for Duotone.
	// Basically, similar to this: https://github.com/wordpress/gutenberg/blob/739f26f6814ba1a32576af5ae5f4c87206d55ff4/lib/block-supports/duotone.php#L354
	function darkpastel_register_block_styles() {
		register_block_style(
			'core/separator',
			array(
				'name'         => 'double-ornament',
				'label'        => __( 'Double Ornament', 'darkpastel' ),
				'inline_style' => '.wp-block-separator.is-style-double-ornament { width: 200px !important; height: 40px !important; background-color: green; clip-path: url("#darkpastel-double-ornament-cp"); }',
			)
		);

		// darkpastel-narrow-ornament-cp

		register_block_style(
			'core/separator',
			array(
				'name'         => 'narrow-ornament',
				'label'        => __( 'Narrow Ornament', 'darkpastel' ),
				'inline_style' => '.wp-block-separator.is-style-narrow-ornament {' .
					              'width: 160px !important;' .
								  'height: 60px !important;' . 
								  '-webkit-mask-image: url("' . esc_url( get_template_directory_uri() ) . '/assets/images/separator-ornament-narrow-optimized.svg");' .
								  'mask-image: url("' . esc_url( get_template_directory_uri() ) . '/assets/images/separator-ornament-narrow-optimized.svg");' .
								  '-webkit-mask-size: 100%;' .
								  'mask-size: 100%;' .
								  '-webkit-mask-repeat: no-repeat;' .
								  'mask-repeat: no-repeat;' .								  
								  '}',
			)
		);

		register_block_style(
			'core/separator',
			array(
				'name'         => 'star',
				'label'        => __( 'Star', 'darkpastel' ),
				'inline_style' => '.wp-block-separator.is-style-star { width: 125px !important; height: 125px !important; border: none !important; clip-path: url("#darkpastel-star-cp" ); }',
			)
		);

		register_block_style(
			'core/separator',
			array(
				'name'         => 'diamond',
				'label'        => __( 'Diamond', 'darkpastel' ),
				'inline_style' => ".wp-block-separator.is-style-diamond { width: 125px !important; height: 125px !important; border: none !important; clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%); }",
			)
		);		
	}
}

add_action( 'init', 'darkpastel_register_block_styles' );